@page
@model IndexModel
@{
    ViewData["Title"] = "Vídeos";
}

<div class="container mt-4">
    <h1 class="display-5 mb-4">Player de Vídeos</h1>

    @if (!string.IsNullOrEmpty(Model.ApiError))
    {
        <div class="alert alert-danger">Erro ao buscar vídeos: @Model.ApiError</div>
    }
    else if (Model.MediaFiles == null || !Model.MediaFiles.Any())
    {
        <div class="alert alert-info">Nenhum vídeo disponível.</div>
    }
    else
    {
        <div class="d-flex flex-column align-items-center">
            <video id="mainVideoPlayer" class="w-100" style="max-width: 800px; max-height: 500px;" controls autoplay muted>
                <source src="@Model.ApiBaseUrl/Videos/@Model.MediaFiles[0].FileName" type="video/mp4" />
                Seu navegador não suporta o elemento de vídeo.
            </video>
            <div class="mt-3">
                <span id="videoTitle" class="fw-bold">@Model.MediaFiles[0].Title</span>
                <span id="videoDescription" class="ms-2">@Model.MediaFiles[0].Description</span>
            </div>
            <div class="mt-3">
                <button id="prevBtn" class="btn btn-secondary me-2">Anterior</button>
                <button id="nextBtn" class="btn btn-secondary">Próximo</button>
            </div>
        </div>
        <script>
            const videos = [
                @for (int i = 0; i < Model.MediaFiles.Count; i++)
                {
                    <text>{
                        src: '@Model.ApiBaseUrl/Videos/@Model.MediaFiles[i].FileName',
                        title: '@Model.MediaFiles[i].Title'.replace("'", "\'") ,
                        description: '@Model.MediaFiles[i].Description'.replace("'", "\'") ,
                    }@((i < Model.MediaFiles.Count - 1) ? "," : "")</text>
                }
            ];
            let current = 0;
            const player = document.getElementById('mainVideoPlayer');
            const title = document.getElementById('videoTitle');
            const desc = document.getElementById('videoDescription');
            player.addEventListener('ended', function () {
                current = (current + 1) % videos.length;
                player.src = videos[current].src;
                title.textContent = videos[current].title;
                desc.textContent = videos[current].description;
                player.play();
            });
            player.play();
        </script>
    }
</div>
